<% layout('layouts/boilerplate.ejs') %>
<div class="grid-wrapper">
    <div class="row">
        <div class="glide">
            <div class="glide__track" data-glide-el="track">
                <ul class="glide__slides">
                    <% restaurant.images.forEach((img, i)=> { %>
                    <li class="glide__slide"><img src="<%= img.url %> " alt="<%= img.filename %>"></li>
                    <% }) %>
                </ul>
                <div class="glide__bullets" data-glide-el="controls[nav]">
                    <% restaurant.images.forEach((img, i)=> { %>
                        <button class="glide__bullet" data-glide-dir="=<%= i %>"></button>
                        <% }) %>
                </div>
                <div class="glide__arrows" data-glide-el="controls">
                    <button class="glide__arrow glide__arrow--left" data-glide-dir="<"><</button>
                    <button class="glide__arrow glide__arrow--right" data-glide-dir=">">></button>
                </div>
            </div>
            
        </div>
        <div class="show__card">
            <h3>
                <%= restaurant.name %>
            </h3>
            <h4>
                <%= `${restaurant.address.street} ${restaurant.address.houseNumber}, ${restaurant.address.city}` %>
            </h4>
            <h4>
                <%= restaurant.cuisine %>
            </h4>
            <h4>
                <%= restaurant.priceRange %>
            </h4>
            <p>
                <%= restaurant.description %>
            </p>
            <p>Submitted by: <%= restaurant.author.username %>
            </p>
            <form action="/restaurants/<%= restaurant.id %>?_method=DELETE" method="POST">
                <button>Delete Restaurant</button>
            </form>
        </div>
    </div>
    <div class="row">
        <div id="showMap"></div>
        <% if (currentUser) { %>
            <section class="show__rating">
                <form action="/restaurants/<%= restaurant.id %>/reviews" method="POST">
                    <div class="show__rating-stars">
                        <fieldset class="starability-slot">
                            <input type="radio" id="no-rate" class="input-no-rate" name="review[rating]" value="1" checked
                                aria-label="No rating." />
                            <input type="radio" id="first-rate1" name="review[rating]" value="1" />
                            <label for="first-rate1" title="Terrible">1 star</label>
                            <input type="radio" id="first-rate2" name="review[rating]" value="2" />
                            <label for="first-rate2" title="Not good">2 stars</label>
                            <input type="radio" id="first-rate3" name="review[rating]" value="3" />
                            <label for="first-rate3" title="Average">3 stars</label>
                            <input type="radio" id="first-rate4" name="review[rating]" value="4" />
                            <label for="first-rate4" title="Very good">4 stars</label>
                            <input type="radio" id="first-rate5" name="review[rating]" value="5" />
                            <label for="first-rate5" title="Amazing">5 stars</label>
                        </fieldset>
                    </div>
                    <div class="show__rating-input">
                        <label for="body">Review:</label>
                        <textarea name="review[body]" id="body" cols="30" rows="10"></textarea>
                        <button>Add review</button>
                    </div>    
                </form>
            </section>
        <% } %>
        <% for(review of restaurant.reviews) { %>
            <div class="card">
                <div class="card-body">
                    <h5 class="card-title">
                        <%= review.author.username %>
                    </h5>
                    <p class="starability-result" data-rating="<%=review.rating%>">
                        Rated: <%= review.rating %> stars
                    </p>
                    <p class="card-text">
                        <%= review.body %>
                    </p>
                    <% if(currentUser && review.author.equals(currentUser.id)) { %>
                        <form action="/restaurants/<%=restaurant.id%>/reviews/<%=review.id%>?_method=DELETE" method="POST"">
                            <button>Delete review</button>
                        </form>
                    <% } %>
                </div>
                
                    
            
            </div>
            <% } %>
        
        
    </div>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/Glide.js/3.5.0/glide.js"
    integrity="sha512-BDOdVHygzrUniS5DJvYBzAHyw5WQRdeVfHSaQmufCfV5s6OFnprcxMsEOAs26Bx6eTGpmlFo4owWiPpr3Voc0w=="
    crossorigin="anonymous" referrerpolicy="no-referrer"></script>
<script>
    new Glide('.glide').mount()
</script>
<script>
    const mapboxToken = '<%- process.env.MAPBOX_TOKEN %>'
    const restaurant = <%- JSON.stringify(restaurant) %>;
</script>
<script src="/javascripts/utilities/showMap.js"></script>
